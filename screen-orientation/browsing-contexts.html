<!DOCTYPE html>
<script src="/resources/testharness.js"></script>
<script src="/resources/testharnessreport.js"></script>
<script src="/resources/testdriver.js"></script>
<script src="/resources/testdriver-vendor.js"></script>

<iframe id="testIframe" src="resources/iframe-lock.html" allowfullscreen="true">
</iframe>

<script>
  promise_test(async t => {
    async function lock() {
      await test_driver.bless("request full screen", () => {
        return document.documentElement.requestFullscreen();
      });
      const currentOrientation = screen.orientation.type;
      const isPortrait = currentOrientation.includes("portrait");
      const newOrientation = `${isPortrait ? "landscape" : "portrait"}-primary`;
      await screen.orientation.lock(newOrientation);
      return document.exitFullscreen;
    }
    const iframe = window.frames["testIframe"];
    await iframe.requestFullscreen();
    const iframeOrientation = iframe.contentWindow.screen.orientation.type;
    const iframePortrait = iframeOrientation.includes("portrait");
    const newFrameOrientation = `${
      iframePortrait ? "landscape" : "portrait"
    }-primary`;
    window.onload = lock();
    promise_rejects(
      t,
      "AbortError",
      iframe.contentWindow.screen.orientation.lock(newFrameOrientation),
      "Descendant browsing context's pending promise is rejected"
    );
    screen.orientation.unlock();
    return document.exitFullscreen();
  }, "Browsing contexts test");
</script>

